from flask import Flask, request, Response, jsonify
from service.DB.simple_db_manager import SimpleDBManager

app = Flask(__name__)
db_manager1 = SimpleDBManager()
db_manager2 = SimpleDBManager()
db_manager3 = SimpleDBManager()
db_manager1.add_malware_url('google.com')
db_manager1.add_malware_url('bestbuy.com')
db_manager2.add_malware_url('linkedin.com')
db_manager3.add_malware_url('walmart.com')

@app.route('/v1/urlinfo/<url>', methods=['GET'])
def handle_url(url):
    if url == None or url == '':
        return Response("Bad request! Enter a valid url", status=400)

    res = {'safe': True}
    if 'a' <= url[0] <= 'i' and db_manager1.is_malware(url):
        res['safe'] = False
    elif 'j' <= url[0] <= 'q' and db_manager2.is_malware(url):
        res['safe'] = False
    elif db_manager3.is_malware(url):
        res['safe'] = False

    return jsonify(res), 200

@app.route('/')
def index():
    return 'Web App with Python Flask!'


app.run(host='0.0.0.0', port=8080)